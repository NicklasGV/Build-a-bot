<div class="script-section">
  <div class="form-section card">
    <h1>Scripts Dashboard</h1>
    <form [formGroup]="scriptForm" (ngSubmit)="onSubmit()" class="script-form">
      <input formControlName="id" type="hidden" />

      <div class="field">
        <label for="title">Title</label>
        <input
          id="title"
          formControlName="title"
          type="text"
          placeholder="Script Title"
        />
      </div>

      <div class="field">
        <label for="userId">Owner</label>
        <select id="userId" formControlName="userId">
          <option value="" disabled selected>— select user —</option>
          <option *ngFor="let u of users" [value]="u.id">{{ u.userName }}</option>
        </select>
      </div>

      <div *ngIf="!isWriting" class="field">
        <label for="fileInput">File</label>
        <input
          id="codeId"
          class="file-field"
          (change)="onFileSelected($event)"
          formControlName="codeId"
          type="file"
          accept=".txt, .py"
        />
        <button
          type="button"
          class="script-writing-btn"
          (click)="toggleEditor()"
          title="Prefer uploading a file over writing inline"
        >
          Write Script
        </button>
      </div>

      <div *ngIf="isWriting" class="field">
        <label>Write Script</label>
        <div class="manoca-card-body">
          <ngx-monaco-editor class="monaco-editor-body" [options]="editorOptions" formControlName="scriptText"></ngx-monaco-editor>
        </div>
        <button
          type="button"
          class="script-writing-btn"
          (click)="toggleEditor()"
        >
          Back to File Upload
        </button>
      </div>

      <div class="field">
        <label for="codeId">Script File Path</label>
        <input
          id="codeId"
          formControlName="codeId"
          placeholder="(auto-filled after upload)"
          readonly
        />
      </div>

      <div class="actions">
        <button type="submit" [disabled]="scriptForm.invalid">
          {{ scriptForm.get('id')?.value ? 'Update Script' : 'Create Script' }}
        </button>
        <button
          *ngIf="scriptForm.touched"
          type="button"
          (click)="cancelEdit()"
        >
          Cancel
        </button>
      </div>
    </form>
  </div>
  
    <div class="scripts-table card">
      <table class="script-table">
        <thead>
          <tr>
            <th class="sorting" (click)="sortBy('id')">
              ID
              <span *ngIf="sortField==='id'">
              {{ sortDir==='asc' ? '▲' : '▼' }}
              </span>
            </th>
            <th class="sorting" (click)="sortBy('title')">
                Title
                <span *ngIf="sortField==='title'">
                {{ sortDir==='asc' ? '▲' : '▼' }}
                </span>
            </th>
            <th class="sorting" (click)="sortBy('description')">
                Description
                <span *ngIf="sortField==='description'">
                {{ sortDir==='asc' ? '▲' : '▼' }}
                </span>
            </th>
            <th class="sorting" (click)="sortBy('userName')">
              User
              <span *ngIf="sortField==='userName'">
              {{ sortDir==='asc' ? '▲' : '▼' }}
              </span>
          </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let u of scripts">
            <td>{{ u.id }}</td>
            <td>{{ u.title }}</td>
            <td>{{ u.description }}</td>
            <td>{{ u.user.userName }}</td>
            <td class="table-actions">
              <button class="edit-btn" (click)="editScript(u.id)">Edit</button>
              <button class="delete-btn" (click)="deleteScript(u.id)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  